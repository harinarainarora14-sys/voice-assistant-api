<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voice & Text Assistant</title>
<style>
/* Minimal CSS: bubbles, buttons, input bar */
body { font-family:sans-serif; background:#0a0a0a; color:#fff; display:flex; flex-direction:column; height:100vh; margin:0; }
#mode-bar { display:flex; gap:6px; padding:10px; background:#111; }
#mode-bar button { flex:1; padding:12px; border:none; border-radius:6px; cursor:pointer; }
#chat-container { flex:1; overflow-y:auto; padding:10px; background:#121212; }
.bubble { padding:10px 14px; margin:5px 0; border-radius:12px; max-width:80%; }
.user { background:#0077cc; color:#fff; margin-left:auto; text-align:right; }
.bot { background:#222; color:#fff; margin-right:auto; text-align:left; }
#text-mode { display:flex; padding:10px; gap:6px; background:#1a1a1a; }
#text-mode input { flex:1; padding:10px; border-radius:6px; border:none; background:#222; color:#fff; }
#text-mode button { padding:10px 12px; border:none; border-radius:6px; cursor:pointer; }
</style>
</head>
<body>

<div id="mode-bar">
  <button id="textModeBtn" class="active" onclick="switchMode('text')">Text Mode</button>
  <button id="voiceBtn" onclick="switchMode('voice')">Voice Chat</button>
  <button id="voiceContBtn" onclick="switchMode('voice-cont')">Voice Continuous</button>
</div>

<div id="chat-container"></div>

<div id="text-mode">
  <input id="textInput" placeholder="Type your message..." onkeydown="if(event.key==='Enter'){sendTextMessage();}">
  <button onclick="sendTextMessage()">Send</button>
  <button onclick="stopAll()">Stop</button>
</div>

<script>
let apiBase = "http://localhost:8000"; // Change if deployed
let useGemini = false;
let currentMode = "text";
let mic = null;
let audioUnlocked = false;

// Gemini toggle button
window.addEventListener("DOMContentLoaded", ()=>{
    const gemBtn = document.createElement("button");
    gemBtn.textContent = "Use Gemini: Off";
    gemBtn.onclick = ()=>{
        useGemini = !useGemini;
        gemBtn.textContent = useGemini?"Use Gemini: On":"Use Gemini: Off";
    };
    document.querySelector("#mode-bar").appendChild(gemBtn);
});

function switchMode(mode){
    currentMode=mode;
    document.getElementById("text-mode").style.display = mode==='text'?'flex':'none';
}

function addMessage(text,sender){
    const c=document.getElementById("chat-container");
    const m=document.createElement("div");
    m.className="bubble "+sender;
    m.innerText=text;
    c.appendChild(m);
    c.scrollTop=c.scrollHeight;
}

// TEXT MODE
async function sendTextMessage(){
    const input=document.getElementById("textInput");
    const text=input.value.trim(); if(!text) return;
    addMessage(text,"user"); input.value="";
    try{
        const res=await fetch(`${apiBase}/ask?question=${encodeURIComponent(text)}&use_gemini=${useGemini}`);
        const data=await res.json();
        const answer=data.answer||"No answer";
        addMessage(answer,"bot");
        speak(answer);
    } catch(e){ addMessage("Error connecting to API","bot"); console.error(e); }
}

// Simple TTS
function speak(txt){
    if(!audioUnlocked){
        speechSynthesis.speak(new SpeechSynthesisUtterance("Voice assistant activated"));
        audioUnlocked=true;
    }
    const u=new SpeechSynthesisUtterance(txt);
    speechSynthesis.speak(u);
}

// STOP
function stopAll(){ if(mic){ mic.stop(); mic=null; } if(speechSynthesis.speaking) speechSynthesis.cancel(); }
</script>

</body>
</html>

